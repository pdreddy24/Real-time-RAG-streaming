services:
  wikimedia-rag-indexer:
    environment:
      METRICS_PORT: "9100"
      # default is "latest" unless you override in your shell/.env
      AUTO_OFFSET_RESET: "${AUTO_OFFSET_RESET:-latest}"
      KAFKA_GROUP: "${KAFKA_GROUP:-rag-indexer-v3}"
    ports:
      - "9100:9100"

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    # Mount the whole folder (safe on Windows); Prometheus will read prometheus.yml inside it
    volumes:
      - ./prometheus:/etc/prometheus:ro
    command:
      - "--config.file=/etc/prometheus/prometheus.yml"
      - "--web.enable-lifecycle"
    ports:
      - "9090:9090"
    depends_on:
      - wikimedia-rag-indexer
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:9090/-/ready"]
      interval: 10s
      timeout: 3s
      retries: 10
